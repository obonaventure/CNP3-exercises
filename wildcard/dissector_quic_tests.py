import unittest
from base64 import b64decode
import base64

from hexdump import hexdump

from quic_tracker.dissector import parse_packet

truth = {'packet': [('Long Header', ('', [('Header Form', 1, 0, 1), ('Long Packet Type', '0x7d', 0, 1), ('Connection ID', '0x7d95bf2e681e2166', 1, 9), ('Version', '0xff000009', 9, 13), ('Packet Number', 1618046010, 13, 17), ('Payload', ('STREAM', [('Frame Type', '0x2', 17, 18), ('OFF bit', 1, 17, 18), ('LEN bit', 1, 17, 18), ('FIN bit', 0, 17, 18), ('Stream ID', 0, 18, 19), ('Offset', 1220, 19, 21), ('Length', 754, 21, 23), ('Stream Data', b'\xf3W,\x05\xa2G\xa3\xf9\xdf\xd9-\xa6\xdc\x01yb\x1e\x8b_[\x97\xda\xc0[\x88{\x1e\xa7=\xd1\xfb#\x90.C\xa0dF\xb3J3[\xfb|pPbX\x18\x01\xce\xdd\xeby\xd2\x9b\x0b\t\x03co\x084\xe0\xdaCs\xb8`f@\xcd\x818\xed?\x93\xce\xcb\x91\x88S\xfci\xd7\xdd\xfe\xb9dG\t\xd3\xc4\xc7e\xf0\x15\x96\xec!dS\xb8~\xc7Ao\xa2\xdf\xe5\x10]\x0f\xabF\x89W\x95\x8d\x82\x85\xda7\x1d\x05\xf1\xd0f?\xc2&)\xbb#:\xd2\x9c\ncp\xc7\xd3\xf0F\xbc\x9c\xd9&\xd3o\x1dE\tA\x82\xe8\xbds\x17\xe3DC\xdc\xb5a\xe8\xa7Y\x17-\xa9\xe6\x03?nJ\xfa\xb1\x98W>\x92\xcf\xe9tU\x1c\xd7q\x00r\xf3\x1e\xba`\x89z\xdb\xf9uv\xd89l0\xe9}ezMj\xb4%\x99\xb2W\xfb\xa2\x86\'\x8e\xd3!\xcf\xeb\xdd\x10\x8e~\xf4\xab\xdf\xa5\xcb;X\x03\x88Z\xa5H\x87)\x8c4V\xfe)0\x9d$/l\xdcx\xed\xd1\xf2\x83\xa2O]``_\x9b\xc5\x1b\x15:\xa1\xc1\xfb.\xd3\x12\xbe\x1a\xd5\x8b\xa6\x00n[\x81\xbd\xf5\n4\x8e\x1e\x8c\xac-\x97`~\xd3\xca\xda\n\xda\xb0\xae\x1d\x99\x08\xdc\x14!T\\\xd8|"\xfe\xdfab\xe6\xed\x9f\x05\xd8\xfb>\xfa\xc7\x91\x99\xadY\\\xb3*\xe6\xb6|\xee\xb1\xf9\xd8\x9b\x9cY^\xee\xc8\xd5\xd5\xd8\xb1\xe1\\\t\xa9\rla\xf1\x06z6\x87\xaf5S\x1cbG\xeew\x82~\x7f\x97\x88\xd7\xb3\xd8tx\xe0Y\x00\x16\xf8\x83\xd5, "+\xb19\xaf\xff\x9f\x08\xa4\xa7\xd9W\xaa\x7f\xec\xa0\xa9d\xbb\x17\x03\x03\x01\x19\x0b\xba\x87D"c"\xba \x8a\xf5\xb3\xa4qn\xdf\x8e[8E`\x85S\x89\x84{z\xbf=\x1am\x9eA\xeb\x93\xe8W\xfd\xb9(\xd6[o\xff+\xfc&\x83\xad\xc6Rr\x8c\x8d\x8d\x9b/R\xc4\xf66G;\x0bz\x0b\xe6\x8c8\xd8\xec\xe7\xf25\xb0\xfa\xfd\x11\xddm)x~\xc149K\xc9\x8b\xf6\x80\x942\x8a\xe7dZ\xf5\xbe\x01\x80\xe5\x1f\xab\x1d\xfe\x0e;\xe7\xf56\x8e\x1f=\xfa\x1b\xa8\xef\xa6\xc4\xbc3\x10\xba\xf0\xc7\x01\xd1\x7f\xb9\xc4\xcf\xf4A\xdb\xb0\x0b\xbax\x9eQ\xd9\xd4\x1d_f\x94\r\xac\xb6;\xbd\xc6\x8d\x84\xbc\xe4)\xb6a[\x1b\x99\x83\n\x1a\xbd\x82\tCa>`GE$\x83\xcc\xeb\x10\x11AU]*\xb4\xf9H\xbe\xc3rXU\x03~\xf8\xc9\xca5*\x13=\xdfK\xbfn`\x01\xc4\xd7\xed`\xf6q\xfcS\xed\xa4\xcc\xb9w\x8b\xcfP\x13\x07IW\x16\x04Y\x97\xa1C\xca\x1c\xdd:\xc6\x0b\xa0\xd6C7\x1f\x04\x18\xc9X\xf4^v\xef\xb9\x99\xbf,\x9eT\xa1\x87\x0fX\x84kY\xc4|x\xaa\x9a\x88\'\xb1\x8f!\x10\xfa\x87\xf7\x8d\x17\x03\x03\x005bv\xb6!\xb8\xa7\x91\xa0\x87\xb7\r\x05\xaf\' ,\x1dt\x07W[KO\xbaT?\xcb-9\xe3]P\x02\x0b\xd1T\xd6\x95\xa5\xac \x08:+\x19L\xc5\x85\xc3\xb9>H\xa6', 23, 777)], 17, 777), 17, 777)], 0, 777), 0, 777)], 'packet2': [('Long Header', ('', [('Header Form', 1, 0, 1), ('Long Packet Type', '0x7f', 0, 1), ('Connection ID', '0xe9522090ebda45bc', 1, 9), ('Version', '0xff000009', 9, 13), ('Packet Number', 1809466813, 13, 17), ('Payload', ('STREAM', [('Frame Type', '0x2', 17, 18), ('OFF bit', 0, 17, 18), ('LEN bit', 1, 17, 18), ('FIN bit', 0, 17, 18), ('Stream ID', 0, 18, 19), ('Length', 639, 19, 21), ('Stream Data', b'\x16\x03\x03\x02z\x01\x00\x02v\x03\x036YfS\xd19Y\xcajD\x84\x1c\x0c)K\xd20\xeb\xbe\x93\xb7[\xa5\x89&\xc2\xe0{<\xdc\xf0T\x00\x00\x04\x13\x01\x13\x02\x01\x00\x02I\x00+\x00\x03\x02\x7f\x17\x00\x00\x00\x12\x00\x10\x00\x00\rquic.ogre.com\x003\x01\xd4\x01\xd2\x00\x17\x00A\x04\xa2]&\x16\x9d<Z);\x0c\xa04\xbd\xd3P\x06\xd0\xcb\xb3\xb1\x03\x02\xcekt\xab\xcemv]LR\xa2\x18\xac\x7f\xf1\xcf\xae\xa35`\'`g\x8dS7\xff\xc5\xa4\xa5\xc1\xe2\xff\xf8Ins\x04&\xc3\xa8\x90\x00\x18\x00a\x04\xc3Y#i\xf7C\x82$]r\xd0N\xd3\x06\xd7.J\x05\xab\xe8b\x9d\xef\xad\xdd\xe4\xe9;1OV%:\x9bb\xaaT"\xb4\x02\xb9\xb4Y\xec\xb7\xbdmC\xf7H\xb1(\x0c(\xc8\x1c\xad\xa0\xc4a^\xa2\xe7\x1c\x88\x92\x93\xd6\xe0\x06\xef\xc8W5\xe3\x1ed^\xf2xah+h\x89\xde\x1ebJ=\xbd~\xe7\x00/0\x01\x00\x01\x00 \x8dr\xca\xf6>\xe6*\xecD\x14\xe4l\xbe\xa1\x92!\x0c\xb7[p\x93\x7f\x8bJ)Q\x19\xcak!\x92i\xc3J\xb1\x7fR\xfa\xf9\xcar\xbd\xfd\x8a\x0c|\xbbt\xf0\xb4r\xac\xe6R;2\x95T\x01#\xba\x8d\xe1\xd5+KdW\x87\xae\xc6\x80go\x952C\xa2\xcei\xe5\x86M\xf4\xd9=\x1c\xaaI(\x12\x08\xeb[\xa2\xd4dY\x8c\x0b\xe7R\xac\x86x\xd1\x02\x97y\x8dm\xc83\x7fZe\xfdK\xe7\xba\x9a\x8f\x86\xces\x909\xf4\xf5\x9f\xe3\x10\xdc\xbf\xb8\xe0\xa8Ae\x05zd\xe5\xfa C\xcabT.\x7f\x1c\xff[\n8\xad\xb4\xe9^XHw.:\x00\xacO+\xa2=&\x94\x19b\x99S\xc8\xdf\x19w+\xe7r\x95\xf0T\xbc<_g\x9a\x90\x81l\x80\xc6\x11\xa7\x90\xcb\xa8\xfcV\xa3\x83\x0e\t\x1a\xf47\x91\xac\x1b\xe7y\x03\xdf\xbam\x8b\xc8Z}B\xe0\x88\xd5\xd6\xbdh\x83\xd3j\x13\x9e\xdc\x82n\x91(Y3\x98\x8f)\xa7k\xaa\xd0\x9ab\x1e6q\x00\x1d\x00 \x07\xc0\xf9{\x00\xf6+\\\x9c\xb8\x86Z7\xfeIB\\\x96\xfa\x08\x10\xbc\xca$\x88\x13\xe7\x85p\xfd?\x02\x00\n\x00\n\x00\x08\x00\x17\x00\x18\x01\x00\x00\x1d\x00\r\x00\x0e\x00\x0c\x08\x04\x08\x05\x08\x06\x04\x03\x05\x03\x06\x03\x00\x10\x00\x08\x00\x06\x05hq-09\x00\x1a\x00$\xff\x00\x00\t\x00\x1e\x00\x00\x00\x04\x00\x00\x00P\x00\x01\x00\x04\x00\x00\x80\x00\x00\x02\x00\x04\x00\x00\x00\x11\x00\x03\x00\x02\x00\n', 21, 660)], 17, 660), 17, 660), ('Payload', ('PADDING', [('Frame Type', '0x0', 660, 661), ('Frame Type', '0x0', 661, 662), ('Frame Type', '0x0', 662, 663), ('Frame Type', '0x0', 663, 664), ('Frame Type', '0x0', 664, 665), ('Frame Type', '0x0', 665, 666), ('Frame Type', '0x0', 666, 667), ('Frame Type', '0x0', 667, 668), ('Frame Type', '0x0', 668, 669), ('Frame Type', '0x0', 669, 670), ('Frame Type', '0x0', 670, 671), ('Frame Type', '0x0', 671, 672), ('Frame Type', '0x0', 672, 673), ('Frame Type', '0x0', 673, 674), ('Frame Type', '0x0', 674, 675), ('Frame Type', '0x0', 675, 676), ('Frame Type', '0x0', 676, 677), ('Frame Type', '0x0', 677, 678), ('Frame Type', '0x0', 678, 679), ('Frame Type', '0x0', 679, 680), ('Frame Type', '0x0', 680, 681), ('Frame Type', '0x0', 681, 682), ('Frame Type', '0x0', 682, 683), ('Frame Type', '0x0', 683, 684), ('Frame Type', '0x0', 684, 685), ('Frame Type', '0x0', 685, 686), ('Frame Type', '0x0', 686, 687), ('Frame Type', '0x0', 687, 688), ('Frame Type', '0x0', 688, 689), ('Frame Type', '0x0', 689, 690), ('Frame Type', '0x0', 690, 691), ('Frame Type', '0x0', 691, 692), ('Frame Type', '0x0', 692, 693), ('Frame Type', '0x0', 693, 694), ('Frame Type', '0x0', 694, 695), ('Frame Type', '0x0', 695, 696), ('Frame Type', '0x0', 696, 697), ('Frame Type', '0x0', 697, 698), ('Frame Type', '0x0', 698, 699), ('Frame Type', '0x0', 699, 700), ('Frame Type', '0x0', 700, 701), ('Frame Type', '0x0', 701, 702), ('Frame Type', '0x0', 702, 703), ('Frame Type', '0x0', 703, 704), ('Frame Type', '0x0', 704, 705), ('Frame Type', '0x0', 705, 706), ('Frame Type', '0x0', 706, 707), ('Frame Type', '0x0', 707, 708), ('Frame Type', '0x0', 708, 709), ('Frame Type', '0x0', 709, 710), ('Frame Type', '0x0', 710, 711), ('Frame Type', '0x0', 711, 712), ('Frame Type', '0x0', 712, 713), ('Frame Type', '0x0', 713, 714), ('Frame Type', '0x0', 714, 715), ('Frame Type', '0x0', 715, 716), ('Frame Type', '0x0', 716, 717), ('Frame Type', '0x0', 717, 718), ('Frame Type', '0x0', 718, 719), ('Frame Type', '0x0', 719, 720), ('Frame Type', '0x0', 720, 721), ('Frame Type', '0x0', 721, 722), ('Frame Type', '0x0', 722, 723), ('Frame Type', '0x0', 723, 724), ('Frame Type', '0x0', 724, 725), ('Frame Type', '0x0', 725, 726), ('Frame Type', '0x0', 726, 727), ('Frame Type', '0x0', 727, 728), ('Frame Type', '0x0', 728, 729), ('Frame Type', '0x0', 729, 730), ('Frame Type', '0x0', 730, 731), ('Frame Type', '0x0', 731, 732), ('Frame Type', '0x0', 732, 733), ('Frame Type', '0x0', 733, 734), ('Frame Type', '0x0', 734, 735), ('Frame Type', '0x0', 735, 736), ('Frame Type', '0x0', 736, 737), ('Frame Type', '0x0', 737, 738), ('Frame Type', '0x0', 738, 739), ('Frame Type', '0x0', 739, 740), ('Frame Type', '0x0', 740, 741), ('Frame Type', '0x0', 741, 742), ('Frame Type', '0x0', 742, 743), ('Frame Type', '0x0', 743, 744), ('Frame Type', '0x0', 744, 745), ('Frame Type', '0x0', 745, 746), ('Frame Type', '0x0', 746, 747), ('Frame Type', '0x0', 747, 748), ('Frame Type', '0x0', 748, 749), ('Frame Type', '0x0', 749, 750), ('Frame Type', '0x0', 750, 751), ('Frame Type', '0x0', 751, 752), ('Frame Type', '0x0', 752, 753), ('Frame Type', '0x0', 753, 754), ('Frame Type', '0x0', 754, 755), ('Frame Type', '0x0', 755, 756), ('Frame Type', '0x0', 756, 757), ('Frame Type', '0x0', 757, 758), ('Frame Type', '0x0', 758, 759), ('Frame Type', '0x0', 759, 760), ('Frame Type', '0x0', 760, 761), ('Frame Type', '0x0', 761, 762), ('Frame Type', '0x0', 762, 763), ('Frame Type', '0x0', 763, 764), ('Frame Type', '0x0', 764, 765), ('Frame Type', '0x0', 765, 766), ('Frame Type', '0x0', 766, 767), ('Frame Type', '0x0', 767, 768), ('Frame Type', '0x0', 768, 769), ('Frame Type', '0x0', 769, 770), ('Frame Type', '0x0', 770, 771), ('Frame Type', '0x0', 771, 772), ('Frame Type', '0x0', 772, 773), ('Frame Type', '0x0', 773, 774), ('Frame Type', '0x0', 774, 775), ('Frame Type', '0x0', 775, 776), ('Frame Type', '0x0', 776, 777), ('Frame Type', '0x0', 777, 778), ('Frame Type', '0x0', 778, 779), ('Frame Type', '0x0', 779, 780), ('Frame Type', '0x0', 780, 781), ('Frame Type', '0x0', 781, 782), ('Frame Type', '0x0', 782, 783), ('Frame Type', '0x0', 783, 784), ('Frame Type', '0x0', 784, 785), ('Frame Type', '0x0', 785, 786), ('Frame Type', '0x0', 786, 787), ('Frame Type', '0x0', 787, 788), ('Frame Type', '0x0', 788, 789), ('Frame Type', '0x0', 789, 790), ('Frame Type', '0x0', 790, 791), ('Frame Type', '0x0', 791, 792), ('Frame Type', '0x0', 792, 793), ('Frame Type', '0x0', 793, 794), ('Frame Type', '0x0', 794, 795), ('Frame Type', '0x0', 795, 796), ('Frame Type', '0x0', 796, 797), ('Frame Type', '0x0', 797, 798), ('Frame Type', '0x0', 798, 799), ('Frame Type', '0x0', 799, 800), ('Frame Type', '0x0', 800, 801), ('Frame Type', '0x0', 801, 802), ('Frame Type', '0x0', 802, 803), ('Frame Type', '0x0', 803, 804), ('Frame Type', '0x0', 804, 805), ('Frame Type', '0x0', 805, 806), ('Frame Type', '0x0', 806, 807), ('Frame Type', '0x0', 807, 808), ('Frame Type', '0x0', 808, 809), ('Frame Type', '0x0', 809, 810), ('Frame Type', '0x0', 810, 811), ('Frame Type', '0x0', 811, 812), ('Frame Type', '0x0', 812, 813), ('Frame Type', '0x0', 813, 814), ('Frame Type', '0x0', 814, 815), ('Frame Type', '0x0', 815, 816), ('Frame Type', '0x0', 816, 817), ('Frame Type', '0x0', 817, 818), ('Frame Type', '0x0', 818, 819), ('Frame Type', '0x0', 819, 820), ('Frame Type', '0x0', 820, 821), ('Frame Type', '0x0', 821, 822), ('Frame Type', '0x0', 822, 823), ('Frame Type', '0x0', 823, 824), ('Frame Type', '0x0', 824, 825), ('Frame Type', '0x0', 825, 826), ('Frame Type', '0x0', 826, 827), ('Frame Type', '0x0', 827, 828), ('Frame Type', '0x0', 828, 829), ('Frame Type', '0x0', 829, 830), ('Frame Type', '0x0', 830, 831), ('Frame Type', '0x0', 831, 832), ('Frame Type', '0x0', 832, 833), ('Frame Type', '0x0', 833, 834), ('Frame Type', '0x0', 834, 835), ('Frame Type', '0x0', 835, 836), ('Frame Type', '0x0', 836, 837), ('Frame Type', '0x0', 837, 838), ('Frame Type', '0x0', 838, 839), ('Frame Type', '0x0', 839, 840), ('Frame Type', '0x0', 840, 841), ('Frame Type', '0x0', 841, 842), ('Frame Type', '0x0', 842, 843), ('Frame Type', '0x0', 843, 844), ('Frame Type', '0x0', 844, 845), ('Frame Type', '0x0', 845, 846), ('Frame Type', '0x0', 846, 847), ('Frame Type', '0x0', 847, 848), ('Frame Type', '0x0', 848, 849), ('Frame Type', '0x0', 849, 850), ('Frame Type', '0x0', 850, 851), ('Frame Type', '0x0', 851, 852), ('Frame Type', '0x0', 852, 853), ('Frame Type', '0x0', 853, 854), ('Frame Type', '0x0', 854, 855), ('Frame Type', '0x0', 855, 856), ('Frame Type', '0x0', 856, 857), ('Frame Type', '0x0', 857, 858), ('Frame Type', '0x0', 858, 859), ('Frame Type', '0x0', 859, 860), ('Frame Type', '0x0', 860, 861), ('Frame Type', '0x0', 861, 862), ('Frame Type', '0x0', 862, 863), ('Frame Type', '0x0', 863, 864), ('Frame Type', '0x0', 864, 865), ('Frame Type', '0x0', 865, 866), ('Frame Type', '0x0', 866, 867), ('Frame Type', '0x0', 867, 868), ('Frame Type', '0x0', 868, 869), ('Frame Type', '0x0', 869, 870), ('Frame Type', '0x0', 870, 871), ('Frame Type', '0x0', 871, 872), ('Frame Type', '0x0', 872, 873), ('Frame Type', '0x0', 873, 874), ('Frame Type', '0x0', 874, 875), ('Frame Type', '0x0', 875, 876), ('Frame Type', '0x0', 876, 877), ('Frame Type', '0x0', 877, 878), ('Frame Type', '0x0', 878, 879), ('Frame Type', '0x0', 879, 880), ('Frame Type', '0x0', 880, 881), ('Frame Type', '0x0', 881, 882), ('Frame Type', '0x0', 882, 883), ('Frame Type', '0x0', 883, 884), ('Frame Type', '0x0', 884, 885), ('Frame Type', '0x0', 885, 886), ('Frame Type', '0x0', 886, 887), ('Frame Type', '0x0', 887, 888), ('Frame Type', '0x0', 888, 889), ('Frame Type', '0x0', 889, 890), ('Frame Type', '0x0', 890, 891), ('Frame Type', '0x0', 891, 892), ('Frame Type', '0x0', 892, 893), ('Frame Type', '0x0', 893, 894), ('Frame Type', '0x0', 894, 895), ('Frame Type', '0x0', 895, 896), ('Frame Type', '0x0', 896, 897), ('Frame Type', '0x0', 897, 898), ('Frame Type', '0x0', 898, 899), ('Frame Type', '0x0', 899, 900), ('Frame Type', '0x0', 900, 901), ('Frame Type', '0x0', 901, 902), ('Frame Type', '0x0', 902, 903), ('Frame Type', '0x0', 903, 904), ('Frame Type', '0x0', 904, 905), ('Frame Type', '0x0', 905, 906), ('Frame Type', '0x0', 906, 907), ('Frame Type', '0x0', 907, 908), ('Frame Type', '0x0', 908, 909), ('Frame Type', '0x0', 909, 910), ('Frame Type', '0x0', 910, 911), ('Frame Type', '0x0', 911, 912), ('Frame Type', '0x0', 912, 913), ('Frame Type', '0x0', 913, 914), ('Frame Type', '0x0', 914, 915), ('Frame Type', '0x0', 915, 916), ('Frame Type', '0x0', 916, 917), ('Frame Type', '0x0', 917, 918), ('Frame Type', '0x0', 918, 919), ('Frame Type', '0x0', 919, 920), ('Frame Type', '0x0', 920, 921), ('Frame Type', '0x0', 921, 922), ('Frame Type', '0x0', 922, 923), ('Frame Type', '0x0', 923, 924), ('Frame Type', '0x0', 924, 925), ('Frame Type', '0x0', 925, 926), ('Frame Type', '0x0', 926, 927), ('Frame Type', '0x0', 927, 928), ('Frame Type', '0x0', 928, 929), ('Frame Type', '0x0', 929, 930), ('Frame Type', '0x0', 930, 931), ('Frame Type', '0x0', 931, 932), ('Frame Type', '0x0', 932, 933), ('Frame Type', '0x0', 933, 934), ('Frame Type', '0x0', 934, 935), ('Frame Type', '0x0', 935, 936), ('Frame Type', '0x0', 936, 937), ('Frame Type', '0x0', 937, 938), ('Frame Type', '0x0', 938, 939), ('Frame Type', '0x0', 939, 940), ('Frame Type', '0x0', 940, 941), ('Frame Type', '0x0', 941, 942), ('Frame Type', '0x0', 942, 943), ('Frame Type', '0x0', 943, 944), ('Frame Type', '0x0', 944, 945), ('Frame Type', '0x0', 945, 946), ('Frame Type', '0x0', 946, 947), ('Frame Type', '0x0', 947, 948), ('Frame Type', '0x0', 948, 949), ('Frame Type', '0x0', 949, 950), ('Frame Type', '0x0', 950, 951), ('Frame Type', '0x0', 951, 952), ('Frame Type', '0x0', 952, 953), ('Frame Type', '0x0', 953, 954), ('Frame Type', '0x0', 954, 955), ('Frame Type', '0x0', 955, 956), ('Frame Type', '0x0', 956, 957), ('Frame Type', '0x0', 957, 958), ('Frame Type', '0x0', 958, 959), ('Frame Type', '0x0', 959, 960), ('Frame Type', '0x0', 960, 961), ('Frame Type', '0x0', 961, 962), ('Frame Type', '0x0', 962, 963), ('Frame Type', '0x0', 963, 964), ('Frame Type', '0x0', 964, 965), ('Frame Type', '0x0', 965, 966), ('Frame Type', '0x0', 966, 967), ('Frame Type', '0x0', 967, 968), ('Frame Type', '0x0', 968, 969), ('Frame Type', '0x0', 969, 970), ('Frame Type', '0x0', 970, 971), ('Frame Type', '0x0', 971, 972), ('Frame Type', '0x0', 972, 973), ('Frame Type', '0x0', 973, 974), ('Frame Type', '0x0', 974, 975), ('Frame Type', '0x0', 975, 976), ('Frame Type', '0x0', 976, 977), ('Frame Type', '0x0', 977, 978), ('Frame Type', '0x0', 978, 979), ('Frame Type', '0x0', 979, 980), ('Frame Type', '0x0', 980, 981), ('Frame Type', '0x0', 981, 982), ('Frame Type', '0x0', 982, 983), ('Frame Type', '0x0', 983, 984), ('Frame Type', '0x0', 984, 985), ('Frame Type', '0x0', 985, 986), ('Frame Type', '0x0', 986, 987), ('Frame Type', '0x0', 987, 988), ('Frame Type', '0x0', 988, 989), ('Frame Type', '0x0', 989, 990), ('Frame Type', '0x0', 990, 991), ('Frame Type', '0x0', 991, 992), ('Frame Type', '0x0', 992, 993), ('Frame Type', '0x0', 993, 994), ('Frame Type', '0x0', 994, 995), ('Frame Type', '0x0', 995, 996), ('Frame Type', '0x0', 996, 997), ('Frame Type', '0x0', 997, 998), ('Frame Type', '0x0', 998, 999), ('Frame Type', '0x0', 999, 1000), ('Frame Type', '0x0', 1000, 1001), ('Frame Type', '0x0', 1001, 1002), ('Frame Type', '0x0', 1002, 1003), ('Frame Type', '0x0', 1003, 1004), ('Frame Type', '0x0', 1004, 1005), ('Frame Type', '0x0', 1005, 1006), ('Frame Type', '0x0', 1006, 1007), ('Frame Type', '0x0', 1007, 1008), ('Frame Type', '0x0', 1008, 1009), ('Frame Type', '0x0', 1009, 1010), ('Frame Type', '0x0', 1010, 1011), ('Frame Type', '0x0', 1011, 1012), ('Frame Type', '0x0', 1012, 1013), ('Frame Type', '0x0', 1013, 1014), ('Frame Type', '0x0', 1014, 1015), ('Frame Type', '0x0', 1015, 1016), ('Frame Type', '0x0', 1016, 1017), ('Frame Type', '0x0', 1017, 1018), ('Frame Type', '0x0', 1018, 1019), ('Frame Type', '0x0', 1019, 1020), ('Frame Type', '0x0', 1020, 1021), ('Frame Type', '0x0', 1021, 1022), ('Frame Type', '0x0', 1022, 1023), ('Frame Type', '0x0', 1023, 1024), ('Frame Type', '0x0', 1024, 1025), ('Frame Type', '0x0', 1025, 1026), ('Frame Type', '0x0', 1026, 1027), ('Frame Type', '0x0', 1027, 1028), ('Frame Type', '0x0', 1028, 1029), ('Frame Type', '0x0', 1029, 1030), ('Frame Type', '0x0', 1030, 1031), ('Frame Type', '0x0', 1031, 1032), ('Frame Type', '0x0', 1032, 1033), ('Frame Type', '0x0', 1033, 1034), ('Frame Type', '0x0', 1034, 1035), ('Frame Type', '0x0', 1035, 1036), ('Frame Type', '0x0', 1036, 1037), ('Frame Type', '0x0', 1037, 1038), ('Frame Type', '0x0', 1038, 1039), ('Frame Type', '0x0', 1039, 1040), ('Frame Type', '0x0', 1040, 1041), ('Frame Type', '0x0', 1041, 1042), ('Frame Type', '0x0', 1042, 1043), ('Frame Type', '0x0', 1043, 1044), ('Frame Type', '0x0', 1044, 1045), ('Frame Type', '0x0', 1045, 1046), ('Frame Type', '0x0', 1046, 1047), ('Frame Type', '0x0', 1047, 1048), ('Frame Type', '0x0', 1048, 1049), ('Frame Type', '0x0', 1049, 1050), ('Frame Type', '0x0', 1050, 1051), ('Frame Type', '0x0', 1051, 1052), ('Frame Type', '0x0', 1052, 1053), ('Frame Type', '0x0', 1053, 1054), ('Frame Type', '0x0', 1054, 1055), ('Frame Type', '0x0', 1055, 1056), ('Frame Type', '0x0', 1056, 1057), ('Frame Type', '0x0', 1057, 1058), ('Frame Type', '0x0', 1058, 1059), ('Frame Type', '0x0', 1059, 1060), ('Frame Type', '0x0', 1060, 1061), ('Frame Type', '0x0', 1061, 1062), ('Frame Type', '0x0', 1062, 1063), ('Frame Type', '0x0', 1063, 1064), ('Frame Type', '0x0', 1064, 1065), ('Frame Type', '0x0', 1065, 1066), ('Frame Type', '0x0', 1066, 1067), ('Frame Type', '0x0', 1067, 1068), ('Frame Type', '0x0', 1068, 1069), ('Frame Type', '0x0', 1069, 1070), ('Frame Type', '0x0', 1070, 1071), ('Frame Type', '0x0', 1071, 1072), ('Frame Type', '0x0', 1072, 1073), ('Frame Type', '0x0', 1073, 1074), ('Frame Type', '0x0', 1074, 1075), ('Frame Type', '0x0', 1075, 1076), ('Frame Type', '0x0', 1076, 1077), ('Frame Type', '0x0', 1077, 1078), ('Frame Type', '0x0', 1078, 1079), ('Frame Type', '0x0', 1079, 1080), ('Frame Type', '0x0', 1080, 1081), ('Frame Type', '0x0', 1081, 1082), ('Frame Type', '0x0', 1082, 1083), ('Frame Type', '0x0', 1083, 1084), ('Frame Type', '0x0', 1084, 1085), ('Frame Type', '0x0', 1085, 1086), ('Frame Type', '0x0', 1086, 1087), ('Frame Type', '0x0', 1087, 1088), ('Frame Type', '0x0', 1088, 1089), ('Frame Type', '0x0', 1089, 1090), ('Frame Type', '0x0', 1090, 1091), ('Frame Type', '0x0', 1091, 1092), ('Frame Type', '0x0', 1092, 1093), ('Frame Type', '0x0', 1093, 1094), ('Frame Type', '0x0', 1094, 1095), ('Frame Type', '0x0', 1095, 1096), ('Frame Type', '0x0', 1096, 1097), ('Frame Type', '0x0', 1097, 1098), ('Frame Type', '0x0', 1098, 1099), ('Frame Type', '0x0', 1099, 1100), ('Frame Type', '0x0', 1100, 1101), ('Frame Type', '0x0', 1101, 1102), ('Frame Type', '0x0', 1102, 1103), ('Frame Type', '0x0', 1103, 1104), ('Frame Type', '0x0', 1104, 1105), ('Frame Type', '0x0', 1105, 1106), ('Frame Type', '0x0', 1106, 1107), ('Frame Type', '0x0', 1107, 1108), ('Frame Type', '0x0', 1108, 1109), ('Frame Type', '0x0', 1109, 1110), ('Frame Type', '0x0', 1110, 1111), ('Frame Type', '0x0', 1111, 1112), ('Frame Type', '0x0', 1112, 1113), ('Frame Type', '0x0', 1113, 1114), ('Frame Type', '0x0', 1114, 1115), ('Frame Type', '0x0', 1115, 1116), ('Frame Type', '0x0', 1116, 1117), ('Frame Type', '0x0', 1117, 1118), ('Frame Type', '0x0', 1118, 1119), ('Frame Type', '0x0', 1119, 1120), ('Frame Type', '0x0', 1120, 1121), ('Frame Type', '0x0', 1121, 1122), ('Frame Type', '0x0', 1122, 1123), ('Frame Type', '0x0', 1123, 1124), ('Frame Type', '0x0', 1124, 1125), ('Frame Type', '0x0', 1125, 1126), ('Frame Type', '0x0', 1126, 1127), ('Frame Type', '0x0', 1127, 1128), ('Frame Type', '0x0', 1128, 1129), ('Frame Type', '0x0', 1129, 1130), ('Frame Type', '0x0', 1130, 1131), ('Frame Type', '0x0', 1131, 1132), ('Frame Type', '0x0', 1132, 1133), ('Frame Type', '0x0', 1133, 1134), ('Frame Type', '0x0', 1134, 1135), ('Frame Type', '0x0', 1135, 1136), ('Frame Type', '0x0', 1136, 1137), ('Frame Type', '0x0', 1137, 1138), ('Frame Type', '0x0', 1138, 1139), ('Frame Type', '0x0', 1139, 1140), ('Frame Type', '0x0', 1140, 1141), ('Frame Type', '0x0', 1141, 1142), ('Frame Type', '0x0', 1142, 1143), ('Frame Type', '0x0', 1143, 1144), ('Frame Type', '0x0', 1144, 1145), ('Frame Type', '0x0', 1145, 1146), ('Frame Type', '0x0', 1146, 1147), ('Frame Type', '0x0', 1147, 1148), ('Frame Type', '0x0', 1148, 1149), ('Frame Type', '0x0', 1149, 1150), ('Frame Type', '0x0', 1150, 1151), ('Frame Type', '0x0', 1151, 1152), ('Frame Type', '0x0', 1152, 1153), ('Frame Type', '0x0', 1153, 1154), ('Frame Type', '0x0', 1154, 1155), ('Frame Type', '0x0', 1155, 1156), ('Frame Type', '0x0', 1156, 1157), ('Frame Type', '0x0', 1157, 1158), ('Frame Type', '0x0', 1158, 1159), ('Frame Type', '0x0', 1159, 1160), ('Frame Type', '0x0', 1160, 1161), ('Frame Type', '0x0', 1161, 1162), ('Frame Type', '0x0', 1162, 1163), ('Frame Type', '0x0', 1163, 1164), ('Frame Type', '0x0', 1164, 1165), ('Frame Type', '0x0', 1165, 1166), ('Frame Type', '0x0', 1166, 1167), ('Frame Type', '0x0', 1167, 1168), ('Frame Type', '0x0', 1168, 1169), ('Frame Type', '0x0', 1169, 1170), ('Frame Type', '0x0', 1170, 1171), ('Frame Type', '0x0', 1171, 1172), ('Frame Type', '0x0', 1172, 1173), ('Frame Type', '0x0', 1173, 1174), ('Frame Type', '0x0', 1174, 1175), ('Frame Type', '0x0', 1175, 1176), ('Frame Type', '0x0', 1176, 1177), ('Frame Type', '0x0', 1177, 1178), ('Frame Type', '0x0', 1178, 1179), ('Frame Type', '0x0', 1179, 1180), ('Frame Type', '0x0', 1180, 1181), ('Frame Type', '0x0', 1181, 1182), ('Frame Type', '0x0', 1182, 1183), ('Frame Type', '0x0', 1183, 1184), ('Frame Type', '0x0', 1184, 1185), ('Frame Type', '0x0', 1185, 1186), ('Frame Type', '0x0', 1186, 1187), ('Frame Type', '0x0', 1187, 1188), ('Frame Type', '0x0', 1188, 1189), ('Frame Type', '0x0', 1189, 1190), ('Frame Type', '0x0', 1190, 1191), ('Frame Type', '0x0', 1191, 1192), ('Frame Type', '0x0', 1192, 1193), ('Frame Type', '0x0', 1193, 1194), ('Frame Type', '0x0', 1194, 1195), ('Frame Type', '0x0', 1195, 1196), ('Frame Type', '0x0', 1196, 1197), ('Frame Type', '0x0', 1197, 1198), ('Frame Type', '0x0', 1198, 1199), ('Frame Type', '0x0', 1199, 1200), ('Frame Type', '0x0', 1200, 1201), ('Frame Type', '0x0', 1201, 1202), ('Frame Type', '0x0', 1202, 1203), ('Frame Type', '0x0', 1203, 1204), ('Frame Type', '0x0', 1204, 1205), ('Frame Type', '0x0', 1205, 1206), ('Frame Type', '0x0', 1206, 1207), ('Frame Type', '0x0', 1207, 1208), ('Frame Type', '0x0', 1208, 1209), ('Frame Type', '0x0', 1209, 1210), ('Frame Type', '0x0', 1210, 1211), ('Frame Type', '0x0', 1211, 1212), ('Frame Type', '0x0', 1212, 1213), ('Frame Type', '0x0', 1213, 1214), ('Frame Type', '0x0', 1214, 1215), ('Frame Type', '0x0', 1215, 1216), ('Frame Type', '0x0', 1216, 1217), ('Frame Type', '0x0', 1217, 1218), ('Frame Type', '0x0', 1218, 1219), ('Frame Type', '0x0', 1219, 1220), ('Frame Type', '0x0', 1220, 1221), ('Frame Type', '0x0', 1221, 1222), ('Frame Type', '0x0', 1222, 1223), ('Frame Type', '0x0', 1223, 1224), ('Frame Type', '0x0', 1224, 1225), ('Frame Type', '0x0', 1225, 1226), ('Frame Type', '0x0', 1226, 1227), ('Frame Type', '0x0', 1227, 1228), ('Frame Type', '0x0', 1228, 1229), ('Frame Type', '0x0', 1229, 1230), ('Frame Type', '0x0', 1230, 1231), ('Frame Type', '0x0', 1231, 1232), ('Frame Type', '0x0', 1232, 1233), ('Frame Type', '0x0', 1233, 1234), ('Frame Type', '0x0', 1234, 1235), ('Frame Type', '0x0', 1235, 1236)], 660, 1236), 660, 1236)], 0, 1236), 0, 1236)]}

def decode(x):
    return base64.encodebytes(bytes.fromhex(x))


class TestDissector(unittest.TestCase):
    #packet TCP
    packet1 = decode("a520" # source port
                     +"04d2" # destination port
                     +"e7c00a6e" # sequence number
                     +"00000000" # ack number
                     +"a0" # Reserved + offset
                     +"02" # Flags
                     +"7080" # Window
                     +"f832" # Checksum
                     +"0000" # Urgent pointer
                     +"020405a00402080ae7379c470000000001030309") # tcp syn"""
    packet2 = b'BNKlIE/GFHDnwApvoBJvkPgyAAACBAWgBAIICovqL7jnN5xHAQMDCQ==\n' # tcp syn+ack
    packet3 = b'pSAE0ufACm9PxhRxgBAAOfgqAAABAQgK5zeijIvqL7g=\n' # tcp ack
    packet4 = b'YAAAAAAgOv/8AAAAAAAAAAAAAAAAAAAC/wIAAAAAAAAAAAAB/wAAAQ==\n' # header ipv6

    # ipv6 + icmpv6 neighbor sollicitation:
    packet5 = decode("6000000000203afffc000000000000000000000000000002ff0200000000000000000001ff0000018700ef4200000000fc0000000000000000000000000000010101aef39afe4864")
    # ipv6 + icmpv6 neighbor advertisement:
    packet6 = decode("6000000000203afffc000000000000000000000000000001fc0000000000000000000000000000028800fd5760000000fc0000000000000000000000000000010201d2686ad8e703")

    @staticmethod
    def parse(packet):
        return parse_packet(bytearray(b64decode(packet)), {})[1]


if __name__ == '__main__':
    def set_test_function(packet_name):
        setattr(TestDissector, 'test_' + k, lambda self: self.assertEqual(truth[packet_name], self.parse(getattr(self, packet_name))))

    # for k in truth:
    #     set_test_function(k)
    #
    # TestDissector.maxDiff = None

    # print(hexdump(b64decode(TestDissector.packet1)))
    truth = {}
    for k in TestDissector.__dict__:
        if k.startswith('packet'):
            truth[k] = TestDissector.parse(getattr(TestDissector, k))
    print(truth)

    unittest.main()


